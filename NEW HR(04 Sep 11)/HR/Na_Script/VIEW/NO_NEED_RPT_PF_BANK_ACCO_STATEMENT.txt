--======== BANK STATEMENT OPTION ONE MAY BE FINAL======
CREATE OR REPLACE PROCEDURE RPT_PF_BANK_ACCO_STATEMENT
(p_test_cursor in out
test_package.test_type,
P_BANK_CODE VARCHAR2,
P_ACCOUNT_TYPE VARCHAR2,
P_ACCOUNT_NO VARCHAR2,
P_BEGIN_DATE DATE,
P_END_DATE DATE
)
as
begin 
open p_test_cursor for  
SELECT 
0 AS ID,
P_BEGIN_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
'OPENING BALANCE' AS DES,
AMOUNT AS O_AMOUNT,0 AS P_AMOUNT,
' ' AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE,
' ' AS CHECK_NO,
' ' AS VOUCHER_NO 
FROM 
MEMBER_FUND 
WHERE  
ACCOUNT_TYPE=P_ACCOUNT_TYPE 
AND ACCOUNT_NO=P_ACCOUNT_NO 
AND BANK_CODE=P_BANK_CODE 
UNION 
SELECT 
PF_RECEIVE_ID AS ID,
RECEIVE_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
DESCRIPTION AS DES,
RECEIVED_AMOUNT AS O_AMOUNT,0 AS P_AMOUNT,
RECEIVE_TYPE AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE,
CHECK_NO,
VOUCHER_NO 
FROM PF_RECEIVE
WHERE 
ACCOUNT_TYPE=P_ACCOUNT_TYPE 
AND ACCOUNT_NO=P_ACCOUNT_NO 
AND BANK_CODE=P_BANK_CODE 
AND RECEIVE_DATE BETWEEN P_BEGIN_DATE AND P_END_DATE 
GROUP BY 
PF_RECEIVE_ID,RECEIVE_DATE,ACCOUNT_NO,ACCOUNT_TYPE,DESCRIPTION,RECEIVED_AMOUNT,RECEIVE_TYPE,BANK_CODE,CHECK_NO,VOUCHER_NO 

UNION
SELECT 
PF_PAYMENT_ID AS ID,
PAYMENT_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
DESCRIPTION AS DES,
0 AS O_AMOUNT,PAYMENT_AMOUNT AS P_AMOUNT,
PAYMENT_TYPE AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE,
CHECK_NO,
VOUCHER_NO 
FROM PF_PAYMENT
WHERE 
ACCOUNT_TYPE=P_ACCOUNT_TYPE 
AND ACCOUNT_NO=P_ACCOUNT_NO 
AND BANK_CODE=P_BANK_CODE 
AND PAYMENT_DATE BETWEEN P_BEGIN_DATE AND P_END_DATE 
GROUP BY 
PF_PAYMENT_ID,PAYMENT_DATE,ACCOUNT_NO,ACCOUNT_TYPE,DESCRIPTION,PAYMENT_AMOUNT,PAYMENT_TYPE,BANK_CODE,CHECK_NO,VOUCHER_NO;
END RPT_PF_BANK_ACCO_STATEMENT;

/


=================== END OF OPTION ONE=============
