



























=================== END OF OPTION ONE=============

======== BANK STATEMENT OPTION TWO ======
CREATE OR REPLACE PROCEDURE RPT_GRA_BANK_ACCO_STATEMENT
(p_test_cursor in out
test_package.test_type,
P_BANK_CODE VARCHAR2,
P_ACCOUNT_TYPE VARCHAR2,
P_ACCOUNT_NO VARCHAR2,
P_BEGIN_DATE DATE,
P_END_DATE DATE
)
as
begin
open p_test_cursor for
SELECT
0 as ID,
P_BEGIN_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
'OPENING BALANCE' AS DES,
AMOUNT AS O_AMOUNT,0 AS P_AMOUNT,
' ' AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE
FROM
GRA_CAPITAL_FUND 
WHERE 
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001' 
UNION

SELECT 
GRA_RECEIVE_ID AS ID,
PAYMENT_RECE_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
DESCRIPTION AS DES,
RECEIVED_AMOUNT AS O_AMOUNT,0 AS P_AMOUNT,
PAYMENT_RECE_TYPE AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE
FROM GRATUITY_RECEIVE
WHERE 
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001' 
AND PAYMENT_RECE_DATE BETWEEN '01-JUL-2005' AND '30-JUN-2006' 
GROUP BY GRA_RECEIVE_ID,PAYMENT_RECE_DATE,
ACCOUNT_NO,ACCOUNT_TYPE,
DESCRIPTION,RECEIVED_AMOUNT,
PAYMENT_RECE_TYPE,BANK_CODE  
UNION
SELECT 
GRA_PAYMENT_ID AS ID,
PAYMENT_DATE AS DDATE,
ACCOUNT_NO,
(SELECT TYPE_NAME FROM L_ACCOUNT_TYPE LAT WHERE ACCOUNT_TYPE=LAT.TYPE_ID) AS ACCOUNT_TYPE,
DESCRIPTION AS DES,
0 AS O_AMOUNT,AMOUNT AS P_AMOUNT,
PAYMENT_TYPE AS PT,
(SELECT BANK_NAME FROM L_BANK LB WHERE BANK_CODE=LB.BANK_ID) AS BANK_CODE
FROM GRATUITY_PAYMENT
WHERE 
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001'  
AND PAYMENT_DATE BETWEEN '01-JUL-2005' AND '30-JUN-2006' 
GROUP BY 
GRA_PAYMENT_ID,PAYMENT_DATE,
ACCOUNT_NO,ACCOUNT_TYPE,DESCRIPTION,AMOUNT,
PAYMENT_TYPE,BANK_CODE;
END RPT_GRA_BANK_ACCO_STATEMENT;

--====================================END OF OPTION TWO=========================





--================START OF PROCESS_UPDATE_GRACAPITALFUND=====--

CREATE OR REPLACE PROCEDURE PROCESS_UPDATE_GRACAPITALFUND
(p_test_cursor in out
test_package.test_type,
P_BEGIN_DATE DATE,
P_END_DATE DATE,
P_ACCOUNT_TYPE VARCHAR2,
P_ACCOUNT_NO VARCHAR2,
P_BANK_CODE VARCHAR2
)
as
var_temp number;
V_TOTAL_REC_AMOUNT NUMBER:=0;
V_TOTAL_PAY_AMOUNT NUMBER:=0;
V_MAX_BEGIN_DATE DATE;
V_MAX_END_DATE DATE;
V_AMOUNT NUMBER:=0;
V_UPDATE_AMOUNT NUMBER:=0;
begin
open p_test_cursor for
SELECT
MAX(BEGIN_DATE) INTO V_MAX_BEGIN_DATE
FROM
FISCAL_YEAR_SETUP;
SELECT
MAX(END_DATE) INTO V_MAX_END_DATE
FROM
FISCAL_YEAR_SETUP;
SELECT
SUM(RECEIVED_AMOUNT) INTO V_TOTAL_REC_AMOUNT
FROM
GRATUITY_RECEIVE
WHERE
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001'
AND PAYMENT_RECE_DATE BETWEEN '01-JUL-2005' AND '30-JUN-2006';
SELECT
SUM(AMOUNT) INTO V_TOTAL_PAY_AMOUNT
FROM
GRATUITY_PAYMENT
WHERE
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001'
AND PAYMENT_DATE BETWEEN '01-JUL-2005' AND '30-JUN-2006';
SELECT
AMOUNT INTO V_AMOUNT
FROM
GRA_CAPITAL_FUND
WHERE
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001';
SELECT
COUNT(*) INTO var_temp
FROM
GRA_CAPITAL_FUND
WHERE
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001';
IF var_temp>0 THEN
V_UPDATE_AMOUNT:=((V_AMOUNT + V_TOTAL_REC_AMOUNT)-V_TOTAL_PAY_AMOUNT);
UPDATE GRA_CAPITAL_FUND 
SET 
AMOUNT=V_UPDATE_AMOUNT
WHERE
ACCOUNT_TYPE='001'
AND ACCOUNT_NO='AC-001'
AND BANK_CODE='001';
END IF;
COMMIT;
end PROCESS_UPDATE_GRACAPITALFUND;

/


-- =============END OF PROCESS_UPDATE_GRACAPITALFUND ===============




